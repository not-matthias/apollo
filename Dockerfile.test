FROM mcr.microsoft.com/playwright:v1.55.0-noble

# Install Zola
RUN apt-get update && \
    apt-get install -y wget && \
    wget https://github.com/getzola/zola/releases/download/v0.19.2/zola-v0.19.2-x86_64-unknown-linux-gnu.tar.gz && \
    tar -xzf zola-v0.19.2-x86_64-unknown-linux-gnu.tar.gz && \
    mv zola /usr/local/bin/ && \
    chmod +x /usr/local/bin/zola && \
    rm zola-v0.19.2-x86_64-unknown-linux-gnu.tar.gz && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Install dependencies first for better caching
COPY package*.json ./
RUN npm ci

# Copy the entire project
COPY . .

# Install Playwright browsers (they should already be in the base image)
RUN npx playwright install --with-deps chromium webkit

# Default command
CMD ["npm", "test"]
